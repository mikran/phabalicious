<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Structure of the configuration file | Phabalicious</title>
    <meta name="generator" content="VuePress 1.5.2">
    
    <meta name="description" content="A deployment system and general purpose helper">
    <link rel="preload" href="/phabalicious/assets/css/0.styles.8724a115.css" as="style"><link rel="preload" href="/phabalicious/assets/js/app.a0dcc876.js" as="script"><link rel="preload" href="/phabalicious/assets/js/3.a8946bf4.js" as="script"><link rel="preload" href="/phabalicious/assets/js/12.bfc60ded.js" as="script"><link rel="prefetch" href="/phabalicious/assets/js/10.58970bcb.js"><link rel="prefetch" href="/phabalicious/assets/js/11.74dd907f.js"><link rel="prefetch" href="/phabalicious/assets/js/13.1746a4c7.js"><link rel="prefetch" href="/phabalicious/assets/js/14.631d6dc3.js"><link rel="prefetch" href="/phabalicious/assets/js/15.e9f86779.js"><link rel="prefetch" href="/phabalicious/assets/js/16.79bbd755.js"><link rel="prefetch" href="/phabalicious/assets/js/17.92c6f019.js"><link rel="prefetch" href="/phabalicious/assets/js/18.b0c07537.js"><link rel="prefetch" href="/phabalicious/assets/js/19.d67617f0.js"><link rel="prefetch" href="/phabalicious/assets/js/20.9cb2482f.js"><link rel="prefetch" href="/phabalicious/assets/js/21.76b13cd0.js"><link rel="prefetch" href="/phabalicious/assets/js/22.ef47fd32.js"><link rel="prefetch" href="/phabalicious/assets/js/23.75afdda6.js"><link rel="prefetch" href="/phabalicious/assets/js/24.8f3f0c41.js"><link rel="prefetch" href="/phabalicious/assets/js/4.45282513.js"><link rel="prefetch" href="/phabalicious/assets/js/5.69ba307c.js"><link rel="prefetch" href="/phabalicious/assets/js/6.8bee04d6.js"><link rel="prefetch" href="/phabalicious/assets/js/7.90dd9d27.js"><link rel="prefetch" href="/phabalicious/assets/js/8.6449e185.js"><link rel="prefetch" href="/phabalicious/assets/js/9.8b267180.js"><link rel="prefetch" href="/phabalicious/assets/js/vendors~docsearch.72c12505.js">
    <link rel="stylesheet" href="/phabalicious/assets/css/0.styles.8724a115.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/phabalicious/" class="home-link router-link-active"><!----> <span class="site-name">Phabalicious</span></a> <div class="links"><form id="search-form" role="search" class="algolia-search-wrapper search-box"><input id="algolia-search-input" class="search-query"></form> <nav class="nav-links can-hide"> <a href="https://github.com/factorial-io/phabalicious" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"> <a href="https://github.com/factorial-io/phabalicious" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><a href="/phabalicious/guide.html" class="sidebar-link">How does phabalicious work in two sentences</a></li><li><a href="/phabalicious/installation.html" class="sidebar-link">Installation of needed dependencies</a></li><li><a href="/phabalicious/usage.html" class="sidebar-link">Running phabalicious</a></li><li><a href="/phabalicious/available-tasks.html" class="sidebar-link">Available tasks</a></li><li><a href="/phabalicious/configuration.html" aria-current="page" class="active sidebar-link">Structure of the configuration file</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#name" class="sidebar-link">name</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#needs" class="sidebar-link">needs</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#requires" class="sidebar-link">requires</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#hosts" class="sidebar-link">hosts</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#general-keys" class="sidebar-link">General keys</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-for-the-local-method" class="sidebar-link">Configuration for the local-method</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-for-the-ssh-method" class="sidebar-link">Configuration for the ssh-method</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-for-the-git-method" class="sidebar-link">Configuration for the git-method</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-for-the-composer-method" class="sidebar-link">Configuration for the composer-method</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-for-the-drush-method" class="sidebar-link">Configuration for the drush-method</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-of-the-yarn-method" class="sidebar-link">Configuration of the yarn-method</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-of-the-npm-method" class="sidebar-link">Configuration of the npm-method</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-of-the-artifacts-ftp-method" class="sidebar-link">Configuration of the artifacts--ftp-method</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-of-the-artifacts-git-method" class="sidebar-link">Configuration of the artifacts--git method</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-of-the-artifacts-custom-method" class="sidebar-link">Configuration of the artifacts--custom method</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-of-the-docker-method" class="sidebar-link">Configuration of the docker-method</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#configuration-of-the-mattermost-method" class="sidebar-link">Configuration of the mattermost-method</a></li></ul></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#dockerhosts" class="sidebar-link">dockerHosts</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#common" class="sidebar-link">common</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#scripts" class="sidebar-link">scripts</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#jira" class="sidebar-link">jira</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#mattermost" class="sidebar-link">mattermost</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#webhooks" class="sidebar-link">webhooks</a></li><li class="sidebar-sub-header"><a href="/phabalicious/configuration.html#other" class="sidebar-link">other</a></li></ul></li><li><a href="/phabalicious/inheritance.html" class="sidebar-link">Inheritance</a></li><li><a href="/phabalicious/docker-integration.html" class="sidebar-link">Docker integration</a></li><li><a href="/phabalicious/workspace.html" class="sidebar-link">Setup a local dev environment (multibasebox)</a></li><li><a href="/phabalicious/scripts.html" class="sidebar-link">Scripts</a></li><li><a href="/phabalicious/scaffolder.html" class="sidebar-link">Scaffolding arbitrary files</a></li><li><a href="/phabalicious/app-scaffold.html" class="sidebar-link">Scaffolding a new app</a></li><li><a href="/phabalicious/app-create-destroy.html" class="sidebar-link">Creating/ destroying an app from existing configuration</a></li><li><a href="/phabalicious/deploying-artifacts.html" class="sidebar-link">Deploying artifacts</a></li><li><a href="/phabalicious/kubernetes.html" class="sidebar-link">Kubernetes integration</a></li><li><a href="/phabalicious/local-overrides.html" class="sidebar-link">Local overrides</a></li><li><a href="/phabalicious/passwords.html" class="sidebar-link">Passwords</a></li><li><a href="/phabalicious/contribute.html" class="sidebar-link">Contributing to Phabalicious</a></li><li><a href="/phabalicious/Changelog.html" class="sidebar-link">Changelog</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="structure-of-the-configuration-file"><a href="#structure-of-the-configuration-file" class="header-anchor">#</a> Structure of the configuration file</h1> <p>The configuration is fetched from the file <code>fabfile.yaml</code> and should have the following structure:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">name</span><span class="token punctuation">:</span> &lt;the project name<span class="token punctuation">&gt;</span>

<span class="token key atrule">needs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> list of methods

<span class="token key atrule">requires</span><span class="token punctuation">:</span> <span class="token number">2.0</span>

<span class="token key atrule">dockerHosts</span><span class="token punctuation">:</span>
  <span class="token key atrule">docker1</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>

<span class="token key atrule">hosts</span><span class="token punctuation">:</span>
  <span class="token key atrule">host1</span><span class="token punctuation">:</span>
    <span class="token punctuation">...</span>
</code></pre></div><p>Here's the documentation of the supported and used keys:</p> <h2 id="name"><a href="#name" class="header-anchor">#</a> name</h2> <p>The name of the project, it's only used for output.</p> <h2 id="needs"><a href="#needs" class="header-anchor">#</a> needs</h2> <p>List here all needed methods for that type of project. Available methods are:</p> <ul><li><code>local</code> runs all commands for that configuration locally.</li> <li><code>git</code> for deployments via git</li> <li><code>ssh</code></li> <li><code>drush</code> for support of drupal installations</li> <li><code>files</code></li> <li><code>mattermost</code> for slack-notifications</li> <li><code>webhook</code> to invoke webhooks when running specific tasks</li> <li><code>docker</code> for docker-support</li> <li><code>composer</code> for composer support</li> <li><code>drupalconsole</code> for drupal-concole support</li> <li><code>platform</code> for deploying to platform.sh</li> <li><code>artifacts--ftp</code> to deploy to a ftp-server</li> <li><code>artifacts--git</code> to deploy an artifact to a git repository</li></ul> <p><strong>Example for drupal 7</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">needs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> ssh
  <span class="token punctuation">-</span> git
  <span class="token punctuation">-</span> drush
  <span class="token punctuation">-</span> files
</code></pre></div><p><strong>Example for drupal 8 composer based and dockerized</strong></p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">needs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> ssh
  <span class="token punctuation">-</span> git
  <span class="token punctuation">-</span> drush
  <span class="token punctuation">-</span> composer
  <span class="token punctuation">-</span> docker
  <span class="token punctuation">-</span> files
</code></pre></div><h2 id="requires"><a href="#requires" class="header-anchor">#</a> requires</h2> <p>The file-format of phabalicious changed over time. Set this to the lowest version of phabalicious which can handle the file. Should bei <code>2.0</code></p> <h2 id="hosts"><a href="#hosts" class="header-anchor">#</a> hosts</h2> <p>Hosts is a list of host-definitions which contain all needed data to connect to a remote host. Here's an example</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">hosts</span><span class="token punctuation">:</span>
  <span class="token key atrule">exampleHost</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> example.host.tld
    <span class="token key atrule">user</span><span class="token punctuation">:</span> example_user
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">2233</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> dev
    <span class="token key atrule">rootFolder</span><span class="token punctuation">:</span> /var/www/public
    <span class="token key atrule">gitRootFolder</span><span class="token punctuation">:</span> /var/www
    <span class="token key atrule">siteFolder</span><span class="token punctuation">:</span> /sites/default
    <span class="token key atrule">filesFolder</span><span class="token punctuation">:</span> /sites/default/files
    <span class="token key atrule">backupFolder</span><span class="token punctuation">:</span> /var/www/backups
    <span class="token key atrule">supportsInstalls</span><span class="token punctuation">:</span> true<span class="token punctuation">|</span>false
    <span class="token key atrule">supportsCopyFrom</span><span class="token punctuation">:</span> true<span class="token punctuation">|</span>false
    <span class="token key atrule">branch</span><span class="token punctuation">:</span> develop
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>
      <span class="token punctuation">...</span>
    <span class="token key atrule">database</span><span class="token punctuation">:</span>
      <span class="token punctuation">...</span>
    <span class="token key atrule">scripts</span><span class="token punctuation">:</span>
      <span class="token punctuation">...</span>
    <span class="token key atrule">sshTunnel</span><span class="token punctuation">:</span>
      ..

</code></pre></div><p>You can get all host-information including the default values using the phabalicious command <code>about</code>:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>phab --config<span class="token operator">=</span>staging about
</code></pre></div><p>This will print all host configuration for the host <code>staging</code>.</p> <h3 id="general-keys"><a href="#general-keys" class="header-anchor">#</a> General keys</h3> <ul><li><code>type</code> defines the type of installation. Currently there are four types available:
<ul><li><code>dev</code> for dev-installations, they won't backup the databases on deployment</li> <li><code>test</code> for test-installations, similar than <code>dev</code>, no backups on deployments</li> <li><code>stage</code> for staging-installations.</li> <li><code>prod</code> for live-installations. Some tasks can not be run on live-installations as <code>install</code> or as a target for <code>copyFrom</code>
The main use-case is to run different scripts per type, see the <code>common</code>-section.</li></ul></li> <li><code>rootFolder</code>  the web-root-folder of the installation, typically exposed to the public.</li> <li><code>needs</code> a list of needed methods, if not set, the globally set <code>needs</code> gets used.</li> <li><code>configName</code> is set by phabalicious, it's the name of the configuration</li> <li><code>supportsInstalls</code>, default is true for <code>types</code> != <code>prod</code>. If sent to true you can run the <code>install</code>-task</li> <li><code>supportsCopyFrom</code>, default is true. If set to true, you can use that configuration as a source for the <code>copy-from</code>-task.</li> <li><code>backupBeforeDeploy</code> is set to true for <code>types</code> <code>stage</code> and <code>prod</code>, if set to true, a backup of the DB is made before a deployment.</li> <li><code>tmpFolder</code>, default is <code>/tmp</code>.</li> <li><code>environment</code> contains a list of environment variables to set before running any command</li> <li><code>shellProvider</code> defines how to run a shell, where commands are executed, current values are
<ul><li><code>local</code>: all commands are run locally</li> <li><code>ssh</code>: all commands are run via a ssh-shell</li> <li><code>docker-exec</code> all commands are run via docker-exec.</li> <li><code>docker-exec-ver-ssh</code> all commands are run via docker-exec on a remote instance</li></ul></li> <li><code>inheritFromBlueprint</code> this will apply the blueprint to the current configuration. This makes it easy to base the common configuration on a blueprint and just override some parts of it.
<ul><li><code>config</code> this is the blueprint-configuration used as a base.</li> <li><code>variant</code> this is the variant to pass to the blueprint</li></ul></li> <li><code>knownHosts</code> a list of hosts which should be added to the known-hosts file before running a ssh-/git-command. Here's an example:<div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">knownHosts</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> github.com
  <span class="token punctuation">-</span> source.factorial.io<span class="token punctuation">:</span><span class="token number">2222</span>
</code></pre></div>They can be overridden on a per host-basis.</li></ul> <h3 id="configuration-for-the-local-method"><a href="#configuration-for-the-local-method" class="header-anchor">#</a> Configuration for the local-method</h3> <ul><li><code>shellProvider</code> default is <code>local</code>, see above.</li> <li><code>shellExecutable</code> default is <code>/bin/bash</code> The executable for running a shell. Please note, that phabalicious requires a sh-compatible shell.</li> <li><code>shellProviderExecutable</code>, the command, which will create the process for a shell, here <code>/bin/bash</code></li></ul> <h3 id="configuration-for-the-ssh-method"><a href="#configuration-for-the-ssh-method" class="header-anchor">#</a> Configuration for the ssh-method</h3> <ul><li><code>host</code>, <code>user</code>, <code>port</code> are used to connect via SSH to the remote machine. Please make sure SSH key forwarding is enabled on your installation.</li> <li><code>disableKnownHosts</code>, default is false, set to true to ignore the known_hosts-file.</li> <li><code>sshTunnel</code> phabalicious supports SSH-Tunnels, that means it can log in into another machine and forward the access to the real host. This is handy for dockerized installations, where the ssh-port of the docker-instance is not public. <code>sshTunnel</code> needs the following informations
<ul><li><code>bridgeHost</code>: the host acting as a bridge.</li> <li><code>bridgeUser</code>: the ssh-user on the bridge-host</li> <li><code>bridgePort</code>: the port to connect to on the bridge-host</li> <li><code>localPort</code>: the local port which gets forwarded to the <code>destPort</code>. If <code>localPort</code> is omitted, the ssh-port of the host-configuration is used. If the host-configuration does not have a port-property a random port is used.</li> <li><code>destHost</code>: the destination host to forward to</li> <li><code>destHostFromDockerContainer</code>: if set, the docker's Ip address is used for destHost. This is automatically set when using a <code>docker</code>-configuration, see there.</li> <li><code>destPort</code>: the destination port to forward to</li> <li><code>shellProviderExecutable</code>, default is <code>/usr/bin/ssh</code>, the executable to establish the connection.</li></ul></li></ul> <h3 id="configuration-for-the-git-method"><a href="#configuration-for-the-git-method" class="header-anchor">#</a> Configuration for the git-method</h3> <ul><li><code>gitRootFolder</code>  the folder, where the git-repository lies. Defaults to <code>rootFolder</code></li> <li><code>branch</code> the name of the branch to use for deployments, they get usually checked out and pulled from origin.</li> <li><code>ignoreSubmodules</code> default is false, set to false, if you don't want to update a projects' submodule on deploy.</li> <li><code>gitOptions</code> a keyed list of options to apply to a git command. Currently only pull is supported. If your git-version does not support <code>--rebase</code> you can disable it via an empty array: <code>pull: []</code></li></ul> <h3 id="configuration-for-the-composer-method"><a href="#configuration-for-the-composer-method" class="header-anchor">#</a> Configuration for the composer-method</h3> <ul><li><code>composerRootFolder</code> the folder where the composer.json for the project is stored, defaults to <code>gitRootFolder</code>.</li></ul> <h3 id="configuration-for-the-drush-method"><a href="#configuration-for-the-drush-method" class="header-anchor">#</a> Configuration for the drush-method</h3> <ul><li><code>uuid</code> of the drupal 8 site (D8 only) Needed for proper config imports</li> <li><code>siteFolder</code> is a drupal-specific folder, where the settings.php resides for the given installation. This allows to interact with multisites etc.</li> <li><code>filesFolder</code> the path to the files-folder, where user-assets get stored and which should be backed up by the <code>files</code>-method</li> <li><code>revertFeatures</code>, defaults to <code>True</code>, when set all features will be reverted when running a reset (drush only)</li> <li><code>configurationManagement</code>, an array of configuration-labels to import on <code>reset</code>, defaults to <code>['staging']</code>. You can add command arguments for drush, e.g. <code>['staging', 'dev --partial']</code></li> <li><code>database</code> the database-credentials the <code>install</code>-tasks uses when installing a new installation.
<ul><li><code>name</code> the database name</li> <li><code>host</code> the database host</li> <li><code>user</code> the database user</li> <li><code>pass</code> the password for the database user</li> <li><code>prefix</code> the optional table-prefix to use</li> <li><code>skipCreateDatabase</code> do not create a database when running the install task.</li></ul></li> <li><code>adminUser</code>, default is <code>admin</code>, the name of the admin-user to set when running the reset-task on <code>dev</code>-instances</li> <li><code>replaceSettingsFile</code>, default is true. If set to false, the settings.php file will not be replaced when running an install.</li> <li><code>installOptions</code> default is <code>distribution: minimal, locale: en, options: ''</code>. You can change the distribution to install and/ or the locale.</li> <li><code>drupalVersion</code> set the drupal-version to use. If not set phabalicious is trying to guess it from the <code>needs</code>-configuration.</li> <li><code>drushVersion</code> set the used crush-version, default is <code>8</code>. Drush is not 100% backwards-compatible, for phabalicious needs to know its version.</li> <li><code>supportsZippedBackups</code> default is true, set to false, when zipped backups are not supported</li></ul> <h3 id="configuration-of-the-yarn-method"><a href="#configuration-of-the-yarn-method" class="header-anchor">#</a> Configuration of the yarn-method</h3> <ul><li><code>yarnRootFolder</code> folder where the package.json is located.</li> <li><code>yarnBuildCommand</code> build-command for yarn to execute when running the install- or reset-task.</li> <li><code>yarnRunContext</code> in which context should the command be executed. Defaults to <code>host</code>, alternative is <code>dockerHost</code>, which means, that the yarn command is not executed in the context of the host, but instead of the dockerHost. Suitable if you replace the yarn executable by a docker exec method.</li></ul> <h3 id="configuration-of-the-npm-method"><a href="#configuration-of-the-npm-method" class="header-anchor">#</a> Configuration of the npm-method</h3> <ul><li><code>npmRootFolder</code> folder where the package.json is located.</li> <li><code>npmBuildCommand</code> build-command for npm to execute when running the install- or reset-task.</li> <li><code>npmRunContext</code> in which context should the command be executed. Defaults to <code>host</code>, alternative is <code>dockerHost</code>, which means, that the npm command is not executed in the context of the host, but instead of the dockerHost. Suitable if you replace the npm executable by a docker exec method.</li></ul> <h3 id="configuration-of-the-artifacts-ftp-method"><a href="#configuration-of-the-artifacts-ftp-method" class="header-anchor">#</a> Configuration of the artifacts--ftp-method</h3> <ul><li><code>target</code> keeps all configuration bundled:
<ul><li><code>user</code> the ftp-user</li> <li><code>password</code> the ftp password</li> <li><code>host</code> the ftp host</li> <li><code>port</code>, default is 21, the port to connect to</li> <li><code>rootFolder</code> the folder to copy the app into on the ftp-host.</li> <li><code>lftpOptions</code>, an array of options to pass when executing <code>lftp</code></li> <li><code>actions</code> a list of actions to perform. See detailed documentation for more info.</li></ul></li></ul> <h3 id="configuration-of-the-artifacts-git-method"><a href="#configuration-of-the-artifacts-git-method" class="header-anchor">#</a> Configuration of the artifacts--git method</h3> <ul><li><code>target</code> contains the following options
<ul><li><code>repository</code> the url of the target repository</li> <li><code>branch</code> the branch to use for commits</li> <li><code>useLocalRepository</code> if set to true, phab will use the current directory as a source for the artifact, if set to false, phab will create a new app in a temporary folder and use that as a artifact</li> <li><code>actions</code> a list of actions to perform. See detailed documentation for more info.</li></ul></li></ul> <h3 id="configuration-of-the-artifacts-custom-method"><a href="#configuration-of-the-artifacts-custom-method" class="header-anchor">#</a> Configuration of the artifacts--custom method</h3> <ul><li><code>target</code> contains the following options
<ul><li><p><code>actions</code> a list of actions to perform. See detailed documentation for more info.</p></li> <li><p><code>stages</code> a list of custom stages to perform. A combination of these values:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">-</span> installCode
<span class="token punctuation">-</span> installDependencies
<span class="token punctuation">-</span> runActions
<span class="token punctuation">-</span> runDeployScript
</code></pre></div></li></ul></li></ul> <h3 id="configuration-of-the-docker-method"><a href="#configuration-of-the-docker-method" class="header-anchor">#</a> Configuration of the docker-method</h3> <ul><li><code>docker</code> for all docker-relevant configuration. <code>configuration</code> and <code>name</code>/<code>service</code> are the only required keys, all other are optional and used by the docker-tasks.
<ul><li><code>configuration</code> should contain the key of the dockerHost-configuration in <code>dockerHosts</code></li> <li><code>name</code> contains the name of the docker-container. This is needed to get the IP-address of the particular docker-container when using ssh-tunnels (see above).</li> <li>for docker-compose-base setups you can provide the <code>service</code> instead the name, phabalicious will get the docker name automatically from the service.</li></ul></li></ul> <h3 id="configuration-of-the-mattermost-method"><a href="#configuration-of-the-mattermost-method" class="header-anchor">#</a> Configuration of the mattermost-method</h3> <ul><li><code>notifyOn</code>: a list of all tasks where to send a message to a Mattermost channel. Have a look at the global Mattermost-configuration-example below.</li></ul> <h2 id="dockerhosts"><a href="#dockerhosts" class="header-anchor">#</a> dockerHosts</h2> <p><code>dockerHosts</code> is similar structured as the <code>hosts</code>-entry. It's a keyed lists of hosts containing all necessary information to create a ssh-connection to the host, controlling the docker-instances, and a list of tasks, the user might call via the <code>docker</code>-command. See the <code>docker</code>-entry for a more birds-eye-view of the concepts.</p> <p>Here's an example <code>dockerHosts</code>-entry:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">dockerHosts</span><span class="token punctuation">:</span>
  <span class="token key atrule">mbb</span><span class="token punctuation">:</span>
    <span class="token key atrule">runLocally</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> multibasebox.dev
    <span class="token key atrule">user</span><span class="token punctuation">:</span> vagrant
    <span class="token key atrule">password</span><span class="token punctuation">:</span> vagrant
    <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">22</span>
    <span class="token key atrule">rootFolder</span><span class="token punctuation">:</span> /vagrant
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token key atrule">VHOST</span><span class="token punctuation">:</span> %host.host%
      <span class="token key atrule">WEBROOT</span><span class="token punctuation">:</span> %host.rootFolder%
    <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
      <span class="token key atrule">logs</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> docker logs %host.docker.name%
</code></pre></div><p>Here's a list of all possible entries of a dockerHosts-entry:</p> <ul><li><code>shellProvider</code>, the shell-provider to use, currently <code>local</code> or <code>ssh</code>.</li> <li><code>runLocally</code>: if set to true, the <code>local</code>-shell-provider will be used.</li> <li><code>host</code>, <code>user</code> and <code>port</code>: when using the <code>ssh</code>-shell-provicer.</li> <li><code>environment</code> a keyed list of environment-variables to set, when running one of the tasks. The replacement-patterns of <code>scripts</code> are supported, see there for more information.</li> <li><code>tasks</code> a keyed list of commands to run for a given docker-subtask (similar to <code>scripts</code>). Note: these commands are running on the docker-host, not on the host. All replacement-patterns do work, and you can call even other tasks via <code>execute(&lt;task&gt;, &lt;subtask&gt;)</code> e.g. <code>execute(docker, stop)</code> See the <code>scripts</code>-section for more info.</li></ul> <p>You can use <code>inheritsFrom</code> to base your configuration on an existing one. You can add any configuration you may need and reference to that information from within your tasks via the replacement-pattern <code>%dockerHost.keyName%</code> e.g. <code>%dockerHost.host%</code>.</p> <p>You can reference a specific docker-host-configuration from your host-configuration via</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">hosts</span><span class="token punctuation">:</span>
  <span class="token key atrule">test</span><span class="token punctuation">:</span>
    <span class="token key atrule">docker</span><span class="token punctuation">:</span>
      <span class="token key atrule">configuration</span><span class="token punctuation">:</span> mbb
</code></pre></div><h2 id="common"><a href="#common" class="header-anchor">#</a> common</h2> <p>common contains a list of commands, keyed by task and type which gets executed when the task is executed.</p> <p>Example:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">common</span><span class="token punctuation">:</span>
  <span class="token key atrule">reset</span><span class="token punctuation">:</span>
    <span class="token key atrule">dev</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> echo &quot;running reset on a dev<span class="token punctuation">-</span>instance&quot;
    <span class="token key atrule">stage</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> echo &quot;running reset on a stage<span class="token punctuation">-</span>instance&quot;
    <span class="token key atrule">prod</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> echo &quot;running reset on a prod<span class="token punctuation">-</span>instance&quot;
  <span class="token key atrule">deployPrepare</span><span class="token punctuation">:</span>
    <span class="token key atrule">dev</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> echo &quot;preparing deploy on a dev instance&quot;
  <span class="token key atrule">deploy</span><span class="token punctuation">:</span>
    <span class="token key atrule">dev</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> echo &quot;deploying on a dev instance&quot;
  <span class="token key atrule">deployFinished</span><span class="token punctuation">:</span>
    <span class="token key atrule">dev</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> echo &quot;finished deployment on a dev instance&quot;
</code></pre></div><p>The first key is the task-name (<code>reset</code>, <code>deploy</code>, ...), the second key is the type of the installation (<code>dev</code>, <code>stage</code>, <code>prod</code>, <code>test</code>). Every task is prepended by a prepare-stage and appended by a finished-stage, so you can call scripts before and after an actual task. You can even run other scripts via the <code>execute</code>-command, see the <code>scripts</code>-section.</p> <h2 id="scripts"><a href="#scripts" class="header-anchor">#</a> scripts</h2> <p>A keyed list of available scripts. This scripts may be defined globally (on the root level) or on a per host-level. The key is the name of the script and can be executed via</p> <div class="language-bash extra-class"><pre class="language-bash"><code>phab --config<span class="token operator">=</span><span class="token operator">&lt;</span>configuration<span class="token operator">&gt;</span> script <span class="token operator">&lt;</span>key<span class="token operator">&gt;</span>
</code></pre></div><p>A script consists of an array of commands which gets executed sequentially.</p> <p>An example:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">scripts</span><span class="token punctuation">:</span>
  <span class="token key atrule">test</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> echo &quot;Running script test&quot;
  <span class="token key atrule">test2</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> echo &quot;Running script test2 on %host.config_name%
    <span class="token punctuation">-</span> execute(script<span class="token punctuation">,</span> test)
</code></pre></div><p>Scripts can be defined on a global level, but also on a per host-level.</p> <p>You can declare default-values for arguments via a slightly modified syntax:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">scripts</span><span class="token punctuation">:</span>
  <span class="token key atrule">defaultArgumentTest</span><span class="token punctuation">:</span>
    <span class="token key atrule">defaults</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> Bob
    <span class="token key atrule">script</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> echo &quot;Hello %arguments.name%&quot;
</code></pre></div><p>Running the script via <code>phab config:mbb script:defaultArgumentTest,name=&quot;Julia&quot;</code> will show <code>Hello Julia</code>. Running <code>phab config:mbb script:defaultArgumentTest</code> will show <code>Hello Bob</code>.</p> <p>For more information see the main scripts section below.</p> <h2 id="jira"><a href="#jira" class="header-anchor">#</a> jira</h2> <p>The jira-command needs some configuration. It is advised to store this configuration in your user folder (<code>~/.fabfile.local.yaml</code>) or somewhere upstream of your project folder, as it might contain sensitive information.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">jira</span><span class="token punctuation">:</span>
  <span class="token key atrule">host</span><span class="token punctuation">:</span> &lt;jira<span class="token punctuation">-</span>host<span class="token punctuation">&gt;</span>
  <span class="token key atrule">user</span><span class="token punctuation">:</span> &lt;jira<span class="token punctuation">-</span>user<span class="token punctuation">&gt;</span>
  <span class="token key atrule">pass</span><span class="token punctuation">:</span> &lt;jira<span class="token punctuation">-</span>password<span class="token punctuation">&gt;</span>
</code></pre></div><p>The command will use the global <code>key</code> as project-key, you can override that via the following configuration:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">jira</span><span class="token punctuation">:</span>
  <span class="token key atrule">projectKey</span><span class="token punctuation">:</span> &lt;jira project<span class="token punctuation">-</span>key<span class="token punctuation">&gt;</span>
</code></pre></div><h2 id="mattermost"><a href="#mattermost" class="header-anchor">#</a> mattermost</h2> <p>Phabalicious can send notifications to a running Mattermost instance. You need to create an incoming web hook in your instance and pass this to your configuration. Here's an example</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">mattermost</span><span class="token punctuation">:</span>
  <span class="token key atrule">username</span><span class="token punctuation">:</span> phabalicious
  <span class="token key atrule">webhook</span><span class="token punctuation">:</span> https<span class="token punctuation">:</span>//chat.your.server.tld/hooks/<span class="token punctuation">...</span>
  <span class="token key atrule">Channel</span><span class="token punctuation">:</span> <span class="token string">&quot;my-channel&quot;</span>

<span class="token key atrule">hosts</span><span class="token punctuation">:</span>
  <span class="token key atrule">test</span><span class="token punctuation">:</span>
    <span class="token key atrule">needs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mattermost
    <span class="token key atrule">notifyOn</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> deploy
      <span class="token punctuation">-</span> reset
</code></pre></div><ul><li><code>mattermost</code> contains all global mattermost config.
<ul><li><code>username</code> the username to post messages as</li> <li><code>webhook</code> the address of the web-hook</li> <li><code>channel</code> the channel to post the message to</li></ul></li> <li><code>notifyOn</code> is a list of tasks which should send a notification</li></ul> <p>You can test the Mattermost config via</p> <div class="language-bash extra-class"><pre class="language-bash"><code>phab notify <span class="token string">&quot;hello world&quot;</span> --config <span class="token operator">&lt;</span>your-config<span class="token operator">&gt;</span>
</code></pre></div><h2 id="webhooks"><a href="#webhooks" class="header-anchor">#</a> webhooks</h2> <p>Phabalicious provides a command to invoke webhooks from the command line, but also integrates invoking webhooks when running a specific task or as a callback for scripts.</p> <p>Webhooks are declared in the global namespace:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">webhooks</span><span class="token punctuation">:</span>
  <span class="token key atrule">nameOfWebhook</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> &lt;url<span class="token punctuation">-</span>of<span class="token punctuation">-</span>webhook<span class="token punctuation">&gt;</span>
    <span class="token key atrule">method</span><span class="token punctuation">:</span> &lt;get<span class="token punctuation">|</span>post<span class="token punctuation">|</span>delete<span class="token punctuation">&gt;</span>
    <span class="token key atrule">format</span><span class="token punctuation">:</span> &lt;json<span class="token punctuation">|</span>form_params<span class="token punctuation">&gt;</span>
    <span class="token key atrule">payload</span><span class="token punctuation">:</span>
      <span class="token key atrule">prop1</span><span class="token punctuation">:</span> value1
      <span class="token key atrule">prop2</span><span class="token punctuation">:</span> value2
    <span class="token comment"># a list of options passed directly to guzzle.</span>
    <span class="token key atrule">options</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token punctuation">...</span>
</code></pre></div><p>The data in payload get submitted depending on the chosen format, e.g. as JSON or as form-values. You can use the replacement patterns for entries in the payload known similar to scripts, e.g.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">webhooks</span><span class="token punctuation">:</span>
  <span class="token key atrule">demoWebhook</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> &lt;url<span class="token punctuation">&gt;</span>
    <span class="token key atrule">method</span><span class="token punctuation">:</span> get
    <span class="token key atrule">payload</span><span class="token punctuation">:</span>
      <span class="token key atrule">branch</span><span class="token punctuation">:</span> <span class="token string">&quot;%host.branch%&quot;</span>
      <span class="token key atrule">token</span><span class="token punctuation">:</span> <span class="token string">&quot;%settings.token%&quot;</span>
      <span class="token key atrule">someOtherValue</span><span class="token punctuation">:</span> <span class="token string">&quot;%arguments.foo%&quot;</span>
</code></pre></div><p><code>webhooks</code> has a special entry called <code>defaults</code> where you can add common defaults for all webhook invokations like special headers, etc</p> <p>The current defaults are:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">webhooks</span><span class="token punctuation">:</span>
  <span class="token key atrule">defaults</span><span class="token punctuation">:</span>
    <span class="token key atrule">format</span><span class="token punctuation">:</span> json
    <span class="token key atrule">options</span><span class="token punctuation">:</span>
      <span class="token key atrule">headers</span><span class="token punctuation">:</span>
        <span class="token key atrule">User-Agent</span><span class="token punctuation">:</span> phabalicous
        <span class="token key atrule">Accept</span><span class="token punctuation">:</span> application/json

</code></pre></div><p>To invoke a webhook from a script-section, use the built-in function <code>webhook(name-of-webhook, arguments)</code>:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">host</span><span class="token punctuation">:</span>
  <span class="token key atrule">demo</span><span class="token punctuation">:</span>
    <span class="token key atrule">needs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> git
      <span class="token punctuation">-</span> artifacts<span class="token punctuation">-</span><span class="token punctuation">-</span>git
      <span class="token punctuation">-</span> webhook
    <span class="token key atrule">deployFinished</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> echo &quot;Invoking webhook <span class="token punctuation">...</span>&quot;
      <span class="token punctuation">-</span> webhook(myWebhook<span class="token punctuation">,</span> foo=bar)
</code></pre></div><p>Alternatively you can use the <code>webhooks</code>-keyword to provide a mapping of task and webhook to invoke:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">host</span><span class="token punctuation">:</span>
  <span class="token key atrule">demo</span><span class="token punctuation">:</span>
    <span class="token key atrule">needs</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> git
      <span class="token punctuation">-</span> artifacts<span class="token punctuation">-</span><span class="token punctuation">-</span>git
      <span class="token punctuation">-</span> webhook
    <span class="token key atrule">webhooks</span><span class="token punctuation">:</span>
      <span class="token key atrule">deployPrepare</span><span class="token punctuation">:</span> myWebhook1
      <span class="token key atrule">deployFinished</span><span class="token punctuation">:</span> myWebhook2
</code></pre></div><h2 id="other"><a href="#other" class="header-anchor">#</a> other</h2> <ul><li><code>deploymentModule</code> name of the deployment-module the drush-method enables when doing a deploy</li> <li><code>sqlSkipTables</code> a list of table-names drush should omit when doing a backup.</li> <li><code>configurationManagement</code> a list of configuration-labels to import on <code>reset</code>. This defaults to <code>['staging']</code> and may be overridden on a per-host basis. You can add command arguments to the the configuration label.</li></ul> <p>Example:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">deploymentModule</span><span class="token punctuation">:</span> my_deployment_module
<span class="token key atrule">usePty</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">useShell</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">gitOptions</span><span class="token punctuation">:</span>
  <span class="token key atrule">pull</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>rebase
    <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>quiet
<span class="token key atrule">sqlSkipTables</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> cache
  <span class="token punctuation">-</span> watchdog
  <span class="token punctuation">-</span> session
<span class="token key atrule">configurationManagement</span><span class="token punctuation">:</span>
   <span class="token key atrule">staging</span><span class="token punctuation">:</span>
     <span class="token punctuation">-</span> drush config<span class="token punctuation">-</span>import <span class="token punctuation">-</span>y staging
   <span class="token key atrule">dev</span><span class="token punctuation">:</span>
	   <span class="token punctuation">-</span> Drusch config<span class="token punctuation">-</span>import <span class="token punctuation">-</span>y dev <span class="token punctuation">-</span><span class="token punctuation">-</span>partial
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/factorial-io/phabalicious/edit/master/docs/configuration.md" target="_blank" rel="noopener noreferrer">Help us improve this page!</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/phabalicious/available-tasks.html" class="prev">
        Available tasks
      </a></span> <span class="next"><a href="/phabalicious/inheritance.html">
        Inheritance
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/phabalicious/assets/js/app.a0dcc876.js" defer></script><script src="/phabalicious/assets/js/3.a8946bf4.js" defer></script><script src="/phabalicious/assets/js/12.bfc60ded.js" defer></script>
  </body>
</html>
