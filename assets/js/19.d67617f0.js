(window.webpackJsonp=window.webpackJsonp||[]).push([[19],{374:function(t,e,a){"use strict";a.r(e);var s=a(42),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"kubernetes-integration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes-integration"}},[t._v("#")]),t._v(" Kubernetes integration")]),t._v(" "),a("p",[t._v("Phabalicious can help you integrating your app with a kubernetes stack and running your common tasks against an installation hosted on a kubernetes cluster. You can leverage phabalicious scaffolder to create yml definitions for your app and apply them to your cluster automatically. Phab can also help you getting a shell to one of your pods.")]),t._v(" "),a("p",[a("strong",[t._v("Note:")]),t._v("\nThe current version of phabalicious does not support any kind of authorization or authentication. It expects that the local environment is set up correctly for executing "),a("code",[t._v("kubectl")]),t._v("!")]),t._v(" "),a("h2",{attrs:{id:"host-configuration"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#host-configuration"}},[t._v("#")]),t._v(" Host-Configuration")]),t._v(" "),a("p",[t._v("All necessary configuration is located under the "),a("code",[t._v("kube")]),t._v("-property. You can use replacement-patterns to use placeholder to replace certain values. Here's an example:")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("needs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" k8s\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kube")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubeconfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%globals.userFolder%/.kube/my-config"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("SOME_VAR")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" some_value\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("context\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scaffolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("baseUrl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./public/scaffold/kube\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" factorial"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("infra\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" app=%host.kube.parameters.name%\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" type=%host.type%\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("parameters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" config.factorial.io\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("projectSlug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" config\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("dockerImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry.factorial.io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8443/administration/config"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("latest\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("letsencrypt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containerPort")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),t._v("\n")])])]),a("h2",{attrs:{id:"the-defaults"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-defaults"}},[t._v("#")]),t._v(" The defaults")]),t._v(" "),a("p",[t._v("The kubernetes intergration provides sensible defaults for most use-cases. These defaults can be overridden via the actual configuration.")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-exampl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("shellExecutable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /bin/sh\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubectlExecutable")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kubectl\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubectlOptions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kube")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubeconfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("environment")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" default\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scaffolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("baseUrl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" https"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//config.factorial.io/scaffold/kube\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" simple/index.yml\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scaffoldBeforeApply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("applyBeforeDeploy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("waitAfterApply")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("projectFolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("applyCommand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'apply -k .'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deleteCommand")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'delete -k .'")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("deployments")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'%host.kube.parameters.name%'")]),t._v("\n")])])]),a("table",[a("thead",[a("tr",[a("th",[t._v("Property")]),t._v(" "),a("th",[t._v("Description")]),t._v(" "),a("th",[t._v("Example")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("shellExecutable")])]),t._v(" "),a("td",[t._v("What shell to execute inside the pod.")]),t._v(" "),a("td",[a("code",[t._v("/bin/sh")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kubectlExecutable")])]),t._v(" "),a("td",[t._v("The name of the kubectl executable")]),t._v(" "),a("td",[a("code",[t._v("kubectl")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kubectlOptions")])]),t._v(" "),a("td",[t._v("array with command-line options for kubectl, in the format "),a("code",[t._v("--option: value")])]),t._v(" "),a("td",[a("code",[t._v('- --insecure-skip-tls-verify: ""')])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.kubeconfig")])]),t._v(" "),a("td",[t._v("the kubeconfig to use for any kubectl command")]),t._v(" "),a("td",[a("code",[t._v("%globals.userFolder%/.kube/my-kube-config")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.context")])]),t._v(" "),a("td",[t._v("the context to switch before calling any kubectl command")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.environment")])]),t._v(" "),a("td",[t._v("An array of environment variables to set before calling any kubectl command.")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.namespace")])]),t._v(" "),a("td",[t._v("The namespace to apply to all kubectl commands")]),t._v(" "),a("td",[a("code",[t._v("myapp")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.scaffolder.baseUrl")])]),t._v(" "),a("td",[t._v("Base-URL for the scaffolder")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.scaffolder.template")])]),t._v(" "),a("td",[t._v("the template file name to use when scaffolding the definition files")]),t._v(" "),a("td")]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.scaffoldBeforeApply")])]),t._v(" "),a("td",[t._v("If set to true, the definition files will be scaffolded before they get applied")]),t._v(" "),a("td",[a("code",[t._v("true")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.waitAfterApply")])]),t._v(" "),a("td",[t._v("Wait until deployment is finished after apply. Needs "),a("code",[t._v("deployments")]),t._v(" with sensible data")]),t._v(" "),a("td",[a("code",[t._v("true")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.projectFolder")])]),t._v(" "),a("td",[t._v("Where the definition files are stored, also the target for the scaffolding step")]),t._v(" "),a("td",[a("code",[t._v("kube")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.applyCommand")])]),t._v(" "),a("td",[t._v("What command to run to apply the definition files to the cluster")]),t._v(" "),a("td",[a("code",[t._v("apply -k .")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.deleteCommand")])]),t._v(" "),a("td",[t._v("What command to run to delete the app from the cluster")]),t._v(" "),a("td",[a("code",[t._v("delete -k .")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("kube.deployments")])]),t._v(" "),a("td",[t._v("An array of deployment names to check if the deployment is finished")]),t._v(" "),a("td",[a("code",[t._v("- %host.kube.parameters.name%")])])])])]),t._v(" "),a("h2",{attrs:{id:"scaffolding-yml-definitions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#scaffolding-yml-definitions"}},[t._v("#")]),t._v(" Scaffolding yml definitions")]),t._v(" "),a("p",[t._v("Phab can scaffold your yml definition files before running a deployment or on request. You can use all the possibilities from the scaffolding engine and store your parameters inside the fabfile.yaml. This allows you to reuse existing configuration and adapt your kubernetes definition files to environment specific settings.")]),t._v(" "),a("p",[t._v("For this to work your "),a("code",[t._v("kube")]),t._v("-section needs to contain the following parts:")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kube")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("projectFolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" kube/\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scaffolder")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("baseUrl")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./path/to/folder/with/templates "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Can be a url")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" ./path/to/template.yml\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("parameters")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" name of the project\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("projectSlug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" slug"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("of"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("the"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("project\n")])])]),a("p",[t._v("Phab will use the yml file from baseUrl and template and run the scaffold script from there. "),a("code",[t._v("parameters")]),t._v(" are available in the twig templates for replacement and via the "),a("code",[t._v("%parameter%")]),t._v("-notation available in file-names etc. Additionally the complete host-parameters are available via "),a("code",[t._v("host.property_name")]),t._v(", e.g. "),a("code",[t._v("host.kube.projectFolder")]),t._v(" (Surrounded by double curly braces or percents)")]),t._v(" "),a("p",[t._v("Phab adds the following parameters automatically:")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Property")]),t._v(" "),a("th",[t._v("Description")]),t._v(" "),a("th",[t._v("Example")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[a("code",[t._v("scaffoldTimeStamp")])]),t._v(" "),a("td",[t._v("a slugified timestamp when the scaffolding was done. Useful to indicate a change in the definition so kubernetes will recreate a pod for example.")]),t._v(" "),a("td",[a("code",[t._v("20200721-083614Z")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("host.*")])]),t._v(" "),a("td",[t._v("The current host configuration")]),t._v(" "),a("td",[a("code",[t._v("host.rootFolder")]),t._v(", "),a("code",[t._v("host.kube.namespace")])])]),t._v(" "),a("tr",[a("td",[a("code",[t._v("namespace")])]),t._v(" "),a("td",[t._v("The namespace taken from the kube config, defaults to "),a("code",[t._v("default")])]),t._v(" "),a("td",[a("code",[t._v("my-namespace")])])])])]),t._v(" "),a("p",[t._v("An example scaffold.yml-file:")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("requires")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3.5")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("questions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("question")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Hosts for the site\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" array\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("projectSlug")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("question")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Name of the project\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("validation")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/^[a-z0-9]+(?:-[a-z0-9]+)*$/"')]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("error")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Name should only ontain alphanumerics and hyphens\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("letsencrypt")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("question")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Use letsencrypt\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" confirm\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("default")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("namespace")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("question")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Which namespace to deploy to\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("assets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 00"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("app"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("secrets.yml\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("pvc.yml\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 02"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("deployment.yml\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 03"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service.yml\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" 04"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("ingress.yml\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" kustomization.yml\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("scaffold")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" copy_assets(%rootFolder%"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" assets)\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" log_message(success"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" The scaffolded files are stored in the kube"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("folder)\n")])])]),a("p",[t._v("This will prompt for any missing property in "),a("code",[t._v("parameters")]),t._v(" via the questions block and then scaffold the yml files to the projectFolder.")]),t._v(" "),a("p",[t._v("Here's an example yml definition:")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" apps/v1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Deployment\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("project")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" projectSlug "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("selector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchLabels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("template")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("labels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("app")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("type")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" host.type "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("buildDate")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" scaffoldTimestamp "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("containers")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"{{dockerImage}}"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" name "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullPolicy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Always\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("livenessProbe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("httpGet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" containerPort "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("readinessProbe")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n          "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("httpGet")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /\n            "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" containerPort "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("imagePullSecrets")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" registry"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("secrets\n")])])]),a("h2",{attrs:{id:"working-with-contexts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#working-with-contexts"}},[t._v("#")]),t._v(" Working with contexts")]),t._v(" "),a("p",[t._v("phab can support different contexts, just add the name of the context to the "),a("code",[t._v("kube")]),t._v("-configuration. Phab will switch to that context before doing any work, and restore the context afterwards. If an error happens, the context might not get restored correctly.")]),t._v(" "),a("p",[t._v("The preferred way to use different clusters with phabalicious is to have dedicated kubeconfig files and reference them in the project via the "),a("code",[t._v("kubeconfig")]),t._v("-property, e.g.")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kube")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kubeconfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"%globals.userFolder%/.kube/my-config"')]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("context")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" my"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("context\n")])])]),a("p",[t._v("This will make sure, that the context is not available after phab finished its work. You can use replacement patterns for the value of kubeconfig.")]),t._v(" "),a("h2",{attrs:{id:"getting-a-shell-to-one-of-the-pods"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#getting-a-shell-to-one-of-the-pods"}},[t._v("#")]),t._v(" Getting a shell to one of the pods")]),t._v(" "),a("p",[t._v("Phab contains a shell-provider for kubernetes, but it needs some guidance so it knows which pod to connect to. Phab is using a set of selectors to acquire the name of the actual running pod. As every project is different it makes sense to store this information in the "),a("code",[t._v("kube")]),t._v("-section of your host configuration:")]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("hosts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("k8s-example")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kube")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("podSelector")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("service_type=%host.kube.serviceName%\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("serviceName")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" builder\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("...")]),t._v("\n")])])]),a("p",[t._v("The "),a("code",[t._v("podSelector")]),t._v(" contains one or more selectors which get appended to the kubctl call to get the name of the pod. In the above example the podSelector is using a "),a("code",[t._v("%property%")]),t._v(" to use another property of the kube config. This makes it easy to change the pod-selector via the "),a("code",[t._v("--set")]),t._v("-option.")]),t._v(" "),a("p",[t._v("To actually start a shell:")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("phab -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" shell\n")])])]),a("p",[t._v("This should open an interactive shell on your selected pod.")]),t._v(" "),a("p",[t._v("To override the pod-selector in the above example:")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("phab -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" shell --set host.kube.serviceName"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("nginx\n")])])]),a("p",[t._v("this will open a shell to the pod which is the result of the selector "),a("code",[t._v("service_type=nginx")]),t._v(". The actual command will look like this: "),a("code",[t._v("kubectl get pods --namespace <the-namespace> -l <the-pod-selector> -o json")])]),t._v(" "),a("p",[t._v("The shell is also used to run parts of the other commands like "),a("code",[t._v("reset")]),t._v(", "),a("code",[t._v("deploy")]),t._v(", etc.")]),t._v(" "),a("h2",{attrs:{id:"k8s-subcommands"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#k8s-subcommands"}},[t._v("#")]),t._v(" k8s subcommands")]),t._v(" "),a("p",[t._v("the "),a("code",[t._v("k8s")]),t._v(" provides a list of sub-commands, which maps to corresponding "),a("code",[t._v("kubectl")]),t._v(" commands for the most popular use cases. Phab will provide the namespace option when needed and change the current directory to the kube project folder.")]),t._v(" "),a("h3",{attrs:{id:"the-scaffold-subcommand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-scaffold-subcommand"}},[t._v("#")]),t._v(" the "),a("code",[t._v("scaffold")]),t._v(" subcommand")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("phab -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" k8s scaffold\n")])])]),a("p",[t._v("This will run the scaffolder to produce a new set of definition files. Nothing more. The files will be scaffolded to the kube project folder.")]),t._v(" "),a("h3",{attrs:{id:"the-apply-subcommand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-apply-subcommand"}},[t._v("#")]),t._v(" the "),a("code",[t._v("apply")]),t._v(" subcommand")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("phab -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" k8s apply\n")])])]),a("p",[t._v("Applies the definitions files using "),a("code",[t._v("kubectl")]),t._v(" and the property "),a("code",[t._v("applyCommand")]),t._v(" from the kube-configuration. The "),a("code",[t._v("applyCommand")]),t._v(" defaults to "),a("code",[t._v("apply -t .")])]),t._v(" "),a("p",[t._v("If "),a("code",[t._v("scaffoldBeforeApply")]),t._v(" is set to true, the yml definitions get scaffolded before running apply.")]),t._v(" "),a("p",[t._v("If "),a("code",[t._v("waitAfterApply")]),t._v(" is true, then phab will wait for the end of the deployment using "),a("code",[t._v("kubectl rollout status")]),t._v(". This means the execution is blocked until the app is available again and the rollout is finished. Make sure your "),a("code",[t._v("deployments")]),t._v("-configuration is uptodate, as phab needs to know which deployments need to be checked. You can use the "),a("code",[t._v("%property%")]),t._v(" notation to reference the kube configuration.")]),t._v(" "),a("p",[t._v("Here's an example:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('hosts:\n  test-k8s:\n    kube:\n      deployments:\n        - "%host.kube.parameters.name%-builder"\n        - "%host.kube.parameters.name%-nginx"\n        - "%host.kube.parameters.name%-php"\n      parameters:\n        name: my-app\n')])])]),a("p",[t._v("Phab will check the status of the rollouts for "),a("code",[t._v("my-app-builder")]),t._v(", "),a("code",[t._v("my-app-nginx")]),t._v(", "),a("code",[t._v("my-app-php")]),t._v(" before continuing.")]),t._v(" "),a("p",[t._v("You should limit the list of deployments only to the necessary ones to you need to interact to.")]),t._v(" "),a("h3",{attrs:{id:"the-delete-subcommand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-delete-subcommand"}},[t._v("#")]),t._v(" the "),a("code",[t._v("delete")]),t._v(" subcommand")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("phab -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" k8s delete\n")])])]),a("p",[t._v("Run the "),a("code",[t._v("deleteCommand")]),t._v(" to delete the current specs from the cluster.")]),t._v(" "),a("h3",{attrs:{id:"the-kubectl-subcommand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-kubectl-subcommand"}},[t._v("#")]),t._v(" the "),a("code",[t._v("kubectl")]),t._v(" subcommand")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("phab -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" k8s kubectl -- "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("args_for_kubectl"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("Run "),a("code",[t._v("kubectl")]),t._v(" and applying the info from the kube config in the fabfile.")]),t._v(" "),a("p",[t._v("An example:")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("phab -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" k8s kubectl get pods\n")])])]),a("h3",{attrs:{id:"the-rollout-subcommand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-rollout-subcommand"}},[t._v("#")]),t._v(" the "),a("code",[t._v("rollout")]),t._v(" subcommand")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("phab -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" k8s rollout -- "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("args_for_rollout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("Run "),a("code",[t._v("kubectl rollout")]),t._v(" and applying the info from the kube config in the fabfile.")]),t._v(" "),a("p",[t._v("An example:")]),t._v(" "),a("div",{staticClass:"language-shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("phab -c"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("config"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" k8s rollout "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("history")]),t._v(" deployments/nginx\n")])])]),a("h3",{attrs:{id:"the-describe-subcommand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-describe-subcommand"}},[t._v("#")]),t._v(" the "),a("code",[t._v("describe")]),t._v(" subcommand")]),t._v(" "),a("p",[t._v("This subcommand will describe the pod desribed by the podSelector:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("phab -c<config> k8s decribe\n")])])]),a("p",[t._v('It uses the same podSelector mechanism as described under "Getting a shell"')]),t._v(" "),a("h3",{attrs:{id:"the-logs-subcommand"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-logs-subcommand"}},[t._v("#")]),t._v(" the "),a("code",[t._v("logs")]),t._v(" subcommand")]),t._v(" "),a("p",[t._v("This subcommand will print out the logs of a particular pod:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("phab -c<config> k8s logs\n")])])]),a("p",[t._v('It uses the same podSelector mechanism as described under "Getting a shell"')]),t._v(" "),a("h2",{attrs:{id:"integration-into-the-deployment-process-of-phabalicious"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#integration-into-the-deployment-process-of-phabalicious"}},[t._v("#")]),t._v(" Integration into the deployment process of phabalicious")]),t._v(" "),a("p",[t._v("It depends on your project setup if it makes sense to scaffold and apply the definition files when runnning a regular deployment. If you want to opt in you need to set "),a("code",[t._v("applyBeforeDeploy")]),t._v(" to true. If set to true phabalicious will apply your definition files and depending on "),a("code",[t._v("waitAfterApply")]),t._v(" and "),a("code",[t._v("scaffoldBeforeDeploy")]),t._v(" even scaffold the definition files and/ or wait for the successful rollout. All this is run on the "),a("code",[t._v("deployPrepare")]),t._v("-stage")])])}),[],!1,null,null,null);e.default=n.exports}}]);